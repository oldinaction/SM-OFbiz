<?xml version="1.0" encoding="UTF-8"?>
<simple-methods xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/simple-methods-v2.xsd">
	
	<!-- 
		(1) 当事人角色表(PartyRole), 主键是partyId和roleTypeId组成的联合主键, ofbiz的webtools也不提供修改方法, 所以此处用到了原生的sql语句
		(2) call-service运行服务需要将所有参数放到map中, 而在minilang语法中使用标签不太好生成map, 故使用了call-bsh, <![CDATA[]]>中可直接写groovy语法 
	-->
	<simple-method method-name="updatePartyRole" short-description="修改当事人角色" login-required="true">
		<set field="sqlMap" type="NewMap"/>
		<set field="roleTypeId" from-field="parameters.roleTypeId"/>
		<call-bsh >
			<![CDATA[
				sqlMap.put("sqlCommand","update PARTY_ROLE t set t.role_type_id='" + roleTypeId + "' where t.party_id='DemoLead' and t.role_type_id!='BUYER'");
			]]>
		</call-bsh>
		<log message="${sqlMap}" level="info"/>
		<call-service service-name="runOriginalSql" in-map-name="sqlMap">
			<result-to-field result-name="resultMessage" field="resultMessage"/>
		</call-service>
		<log message="runOriginalSql==>${resultMessage}" level="info"/>
	</simple-method>


</simple-methods>